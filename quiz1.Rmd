---
title: "R Notebook"
output: html_notebook
---

# Quiz 1

## Setup

```{r install_packages, results="hide", warning=FALSE, eval=FALSE}
install.packages(c("devtools"))
if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")


BiocManager::install("Biobase")
BiocManager::install("GenomicRanges")
BiocManager::install("SummarizedExperiment")
```

```{r load}
library(SummarizedExperiment)
library(Biobase)
library(GenomicRanges)
```


#### Testing the cache

```{r setup, eval=TRUE}
knitr::opts_chunk$set(cache=FALSE)
```

```{r}
x = rnorm(10)
plot(x,pch=19,col="dodgerblue")
```

```{r}
y = rbinom(20,size=1,prob=0.5)
table(y)
```

#### Working with SummarizedExperiment obj

```{r}
library(Biobase)
library(GenomicRanges)
data(sample.ExpressionSet, package = "Biobase")
se = makeSummarizedExperimentFromExpressionSet(sample.ExpressionSet)
```

```{r}
# genes (rows) x samples (columns).  Cells are expression values (normalized?)
assay(se)
```

```{r}
# phenotype data
colData(se)
```

```{r}
# shows the name of the genes that are being expressed. No data.  Returns a data fram
rowData(se)
```
```{r}
rowRanges(se)
```

```{r se_helpers, results="hide"}
dim(se)
dimnames(se)
```

### Experimental Design - Bottomly and Bodymap

```{r load_bot_bm}
con =url("http://bowtie-bio.sourceforge.net/recount/ExpressionSets/bottomly_eset.RData")
load(file=con)
close(con)
bot = bottomly.eset
pdata_bot=pData(bot)

con =url("http://bowtie-bio.sourceforge.net/recount/ExpressionSets/bodymap_eset.RData")
load(file=con)
close(con)
bm = bodymap.eset
pdata_bm=pData(bm)
```

### Graphing Bodymap

```{r}
library(plotrix)
pie3D(pdata_bm$num.tech.reps,labels=pdata_bm$tissue.type)
```

### Bodymap Heatmaps

Which of the following code chunks will make a heatmap of the 500 most highly expressed genes (as defined by total count), without re-ordering due to clustering?

```{r}
edata = exprs(bm)
row_sums = rowSums(edata)
edata = edata[order(-row_sums),] #this reorders the rows
index = 1:500
heatmap(edata[index,],Rowv=NA,Colv=NA)
```

```{r}
edata = exprs(bm)
row_sums = rowSums(edata)
index = which(rank(row_sums) < 500 ) #no row_sums are less than 500. 
#dim(index)
heatmap(edata[index,],Colv=NA)
```

```{r}
edata = exprs(bm)
row_sums = rowSums(edata)
edata = edata[order(row_sums),] #reorder rows. Ascending order. 
index = which(rank(-row_sums) < 500)
heatmap(edata[index,],Rowv=NA, Colv=NA) #not sure why this failed. 
```

```{r}
edata = exprs(bm)
row_sums = rowSums(edata)
index = which(rank(-row_sums) < 500 ) #rank has nothing to do with "rank" in linear algebra. It give you the indexes of the matrix in ascending order. 
heatmap(edata[index,],Rowv=NA,Colv=NA)
```
### Bodymap graphs

Make an MA-plot of the first sample versus the second sample using the **log2** transform (hint: you may have to add 1 first) and the **rlog** transform from the DESeq2 package. How are the two MA-plots different? Which kind of genes appear most different in each plot?


```{r}
con =url("http://bowtie-bio.sourceforge.net/recount/ExpressionSets/bodymap_eset.RData")
load(file=con)
close(con)
bm = bodymap.eset
pdata = pData(bm)
edata = exprs(bm)
fdata = fData(bm)

#Now make the graph. 
#sample1 vs. #sample2 with log2 transform. 
par(pch=19)
```

#### MA-plot

https://en.wikipedia.org/wiki/MA_plot

```{r}
sample1 = edata[,1]
sample2 = edata[,2]

sdiff = log2(sample1 + 1) - log2(sample2 + 1)
ssum  = log2(sample1 + 1) + log2(sample2 + 1)

plot(ssum, sdiff, col=2, xlab="A", ylab="M")
title("MA Plot")

```


### Bonus exploratory data analysis

```{r}

table(pdata$gender, pdata$tissue.type) #super sparse. 
table(pdata$gender, pdata$race)

summary(edata)

```


## Session information

Here is the session information 

```{r session_info}
devtools::session_info()
```

It is also useful to compile the time the document was processed. This document was processed on: `r Sys.Date()`.

## R Notebook Commands

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

